+++

title = "《代码大全》阅读笔记-13-不常见的数据类型"
date = 2016-04-03T14:13:11+08:00
toc = true
tags = ["代码大全"]
categories = ["读书笔记"]
banner = "img/avatar.png"
author = "Tacey Wong"

+++

> 只有万不得已时才使用全局数据

> ！！！就近原则！！！注释紧随代码，变量紧随使用它们的地方 ——Tacey


## 访问器子程序的优势

+ 你获得了对数据的集中控制
+ 你可以确保对变量的所有引用都得到了保护
+ 自动获取信息隐藏的普遍益处
+ 访问器子程序可以很容易转变为抽象数据类型

## 如何使用访问器子程序：

+ 要求所有的代码通过访问器子程序来存储数据：比如，所有全局以g_开头，除了访问器，其他代码都不得访问
+ 不要把所有的全局数据都扔在一处：尽量把全局数据和访问器子程序打包到适合的类里面
+ 用锁定来控制对全局变量的访问：锁定要求使用或者更新一个全局变量值之前，该变量必须被签出，完成使用之后再签入。（加锁）
+ 在访问器子程序里构建一个抽象层
+ 对一项数据的所有访问都应该在同一个层次上（操作一致性）

降低全局数据的风险：

+ 创建一种命名规则来突出全局变量
+ 为全部的全局变量创建一份注释良好的清单
+ 不要用全局变量来存放中间结果
+ 不要把所有的数据都放在一个大对象中并导出传递，以说明你没有使用全局变量



## 核对表（使用不常见数据类型的注意事项）

### 结构体

+ 你使用结构体而不是使用单纯的变量来组织和操作相关的数据吗？
+ 你考虑创建一个类来代替使用结构体吗？


### 全局数据

+ 所有的变量是否都是局部的或者是类范围的？除非绝对必要才是全局的？
+ 变量的命名规则能把局部数据、类数据和全局数据区分开吗？
+ 你对所有的全局变量都加以文档说明吗？
+ 避免使用伪全局数据，即被四处传递且包含有杂乱数据的巨大对象吗？
+ 用访问子程序来取代全局数据吗？
+ 把访问子程序和数据组织到类里面吗？
+ 访问器子程序提供了一个在底层数据类型实现之上的抽象层吗？
+ 所有相关的访问器子程序都位于同一抽象层吗？

### 指针

+ 把指针操作隔离在子程序里吗？
+ 指针引用合法吗？或者说指针有可能成为空悬指针吗？
+ 代码在使用指针之前检查他的有效性吗？
+ 在使用指针所指向的变量之前检查其有效性吗？
+ 指针用完后被设置为空值吗？
+ 就可读性而言，代码用了所有需要使用的指针变量吗？
+ 链表中的指针是按正确的顺序加以释放吗？
+ 程序分配了一片保留的内存后备区域，一遍在耗尽内存的时候能够优雅地退出吗？
+ 是不是在没有其他方法可用的情况下最终才使用指针的？

## 要点

+ 结构体可以使得程序更简单、更容易理解，以及更容易维护
+ 每当你打算使用结构体的时候，考虑采用类是不是会工作的更好。
+ 指针很容易出错。用访问子程序或类以及防御式编程实践来保护自己的代码。
+ **避免使用全局变量，不只是因为它们危险，还是因为你可以用其他更好的方法取代它们。**
+ 如果你不得不使用全局变量，那么就通过访问子程序来使用它。访问器子程序能为你带来全局变量所能带来的一切优点，还有一些额外的好处。